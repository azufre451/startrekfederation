<?php
error_reporting(E_ALL);
ini_set('display_errors', 1);

include('includes/app_include.php');
include('includes/validate_class.php');
include("includes/PHPTAL/PHPTAL.php");



if(isSet($_GET['readnews']))
{
	$vali = new validator();
	$to = $vali->numberOnly($_GET['readnews']);
	setlocale(LC_TIME, 'it_IT');
	
	$news = mysql_query("SELECT * FROM fed_news WHERE newsID = $to");
	$template = new PHPTAL('TEMPLATES/index_news.htm');
	
	$newsA = mysql_fetch_array($news);
	
	$template->ID = $newsA['newsID'];
	$template->title = $newsA['newsTitle'];
	$template->subtitle = $newsA['newsSubTitle'];
	$template->text = str_replace($bbCode,$htmlCode,$newsA['newsText']);
	$template->timer = (strftime('%e', $newsA['newsTime']).' '.ucfirst(strftime('%B', $newsA['newsTime'])).' '.(date('Y', $newsA['newsTime'])+368));
}

else if(isSet($_GET['gallery']))
{
	$template = new PHPTAL('TEMPLATES/index_gallery.htm');
}

else if(isSet($_GET['directory']))
{
	$template = new PHPTAL('TEMPLATES/index_directory.htm');
}

else if(isSet($_GET['thanks']))
{
	$template = new PHPTAL('TEMPLATES/thankyou.htm');
}

else
{

$template = new PHPTAL('TEMPLATES/index.htm');
$template->mod = (isSet($_GET['mod'])) ? $_GET['mod'] : '';
$template->error = (isSet($_GET['error'])) ? $_GET['error'] : NULL; 
$template->success = (isSet($_GET['success'])) ? $_GET['success'] : NULL; 
$template->currentStarDate = $currentStarDate;

setlocale(LC_TIME, 'it_IT');
$template->datae = strftime('%e').' '.ucfirst(strftime('%B')).' '.(date('Y')+368);

$news = mysql_query("SELECT * FROM fed_news ORDER BY newsTime DESC LIMIT 3");
$articles=array();
while($re = mysql_fetch_array($news))
$articles[] = $re;

/*Aut Reg*/
$a1 = array('ALFA','BETA','GAMMA','DELTA','ETA','EPSILON','ZETA','ETA','THETA','IOTA','KAPPA','LAMBDA','MI','NI','XI','OMICRON','PI','RHO','SIGMA','TAU','YPSILON','PHI','CHI','PSI','OMEGA');
$template->aut = $a1[rand(0,24)].' '.$a1[rand(0,24)].' '.rand(0,10).' '.rand(0,10);


/*Admins*/
$adm = mysql_query("SELECT pgID, pgSpecie, pgSesso, pgUser, pgGrado,pgAvatar, pgIncarico, pgSezione, ordinaryUniform FROM pg_users,pg_ranks WHERE prio = rankCode AND pgID IN (1,5)");
while ($admres = mysql_fetch_array($adm)) $admT[$admres['pgID']] = $admres;
$template->admT = $admT;


$template->articles=$articles;
$template->gameVersion = $gameVersion;
$template->debug = $debug;
$template->tips = $tips;
$template->gameServiceInfo = $gameServiceInfo;
}

$template->online = timeHandler::getOnline(NULL);
//echo "WALALO:".mktime(23,59,59,1,14,2013);
	try 
	{
		echo $template->execute();
	}
		catch (Exception $e){
	echo $e;
	}
?>